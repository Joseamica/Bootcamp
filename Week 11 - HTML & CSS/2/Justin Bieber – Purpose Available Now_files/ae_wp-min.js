function AEJSReady(e){if(AEJSWP.debugOutput("AEJSReady fired"),AEJSWP.detect_safari_incognito()?AEJSWP.display_browser_config_error("safari_incognito"):AEJSWP.detect_cookies_enabled()||AEJSWP.display_browser_config_error("cookies_disabled"),void 0!==AEJSWP.ae_framework_reloaded&&AEJSWP.ae_framework_reloaded)return AEJSWP.debugOutput("But not re-running AEJSReady init as this is a framework reload, instead starting auth flow with provider = "+AEJSWP.auth_service_after_reload),void AEJSWP.aeJS.trigger.authenticate(AEJSWP.auth_service_after_reload,"register");if(AEJSWP.aeJS=e,e.events.onFlow.addHandler(AEJSWP.flowHandler),e.events.onLogin.addHandler(AEJSWP.loginHandler),e.events.onLogout.addHandler(AEJSWP.logoutHandler),e.events.onUser.addHandler(AEJSWP.userHandler),e.events.onWindow.addHandler(AEJSWP.windowHandler),e.events.onMobileDetect.addHandler(AEJSWP.mobileDetectHandler),e.events.onEmailVerify.addHandler(AEJSWP.emailVerifyHandler),e.events.onPasswordReset.addHandler(AEJSWP.passwordResetHandler),"detect"==AEJSWP.flow_type?(e.settings.mobile_detect=!0,e.settings.auth_window=!0):e.settings.auth_window="modal"==AEJSWP.flow_type,e.settings.extra_fields_screen=AEJSWP.extra_fields_screen,e.settings.extra_fields=AEJSWP.extra_fields,e.settings.minimum_age=AEJSWP.minimum_age?AEJSWP.minimum_age:null,e.settings.services=AEJSWP.services,e.settings.flow_css=""!=AEJSWP.flow_css?AEJSWP.flow_css:null,e.settings.verify_email=!!AEJSWP.verify_email,e.settings.verify_email_for_login=!!AEJSWP.verify_email,e.settings.flow_text=AEJSWP.flow_text,e.settings.no_email=!!AEJSWP.no_email,e.settings.hide_email_form=!!AEJSWP.hide_email_form,e.settings.social_first=!!AEJSWP.social_first,e.settings.return_url=AEJSWP.return_url,e.settings.email_format=AEJSWP.email_format,e.settings.date_format=AEJSWP.date_format,e.settings.sso=AEJSWP.sso_type,""!=AEJSWP.extra_info&&(e.settings.extra_info=AEJSWP.extra_info),void 0!==AEJSWP.validation_target&&""!=AEJSWP.validation_target)if("widget"!=AEJSWP.validation_target){var t=parseInt(AEJSWP.validation_target.replace("cform-",""));AEJSWP.debugOutput("Validation Target is custom form "+t),AEJSWP.applyCustomFormSettings(t)}else AEJSWP.debugOutput("Validation Target is widget");else AEJSWP.debugOutput("Validation Target not defined, assuming widget"),AEJSWP.validation_target;AEJSWP.user_logging_in=!1,AEJSWP.ae_login_fired=!1,AEJSWP.custom_form_complete=!1,AEJSWP.getLocalStorageItem("aeswp_cform_mailing_lists_completed")||AEJSWP.setLocalStorageItem("aeswp_cform_mailing_lists_completed",[],!0);var r=AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0);AEJSWP.getLocalStorageItem("aejswp_optin_choices")?AEJSWP.getSessionStorageItem("aejswp_initial_optin_choices",!0)||AEJSWP.setSessionStorageItem("aejswp_initial_optin_choices",r,!0):AEJSWP.setLocalStorageItem("aejswp_optin_choices",[],!0),AEJSWP.getSessionStorageItem("aejswp_initial_optin_choices",!0)||AEJSWP.setSessionStorageItem("aejswp_initial_optin_choices",[],!0),AEJSWP.debugOutput("",AEJSWP),AEJSWP.debugOutput("AEJSReady: ",e),AEJSWP.getLocalStorageItem("aejswp_cform_id")&&(AEJSWP.debugOutput("Custom Form flow still in progress"),AEJSWP.applyCustomFormSettings(AEJSWP.getLocalStorageItem("aejswp_cform_id")));for(var o=0;o<AEJSWP.aejsready_handlers.length;o++)AEJSWP.debugOutput("Calling custom aejsready_handler : "+AEJSWP.aejsready_handlers[o]),AEJSWP.executeFunctionByName(AEJSWP.aejsready_handlers[o],window,e)}function AEJSWP_customFormSubmitRecaptcha(e){return new Promise(function(e,t){AEJSWP.debugOutput("Recaptcha callback activated"),AEJSWP.customFormEventFormID&&(AEJSWP.renderCaptcha(AEJSWP.customFormEventFormID),AEJSWP.custom_forms[AEJSWP.customFormEventFormID].captchaVerified=!0),AEJSWP.customFormEvent&&AEJSWP.customFormSubmit(AEJSWP.customFormEventFormID,AEJSWP.customFormEvent),e()})}AEJSWP.updateCustomForms_afterWaitForAeJS=function(){void 0!==AEJSWP.aeJS?AEJSWP.updateCustomForms():(AEJSWP.wait_for_aejs_retry_count++,AEJSWP.wait_for_aejs_retry_count>600?console.log("AEJSWP: Giving up waiting for aeJS after 1 minute - something is broke"):setTimeout(AEJSWP.updateCustomForms_afterWaitForAeJS,100))},jQuery(document).ready(function(){AEJSWP.redirectFlowSigninErrorCheck(),AEJSWP.addAuthenticatorClickHandler(),void 0!==AEJSWP.aeJS&&AEJSWP.authConnect(AEJSWP.aeJS.user),AEJSWP.addCustomFormListeners(),AEJSWP.wait_for_aejs_retry_count=0,AEJSWP.updateCustomForms_afterWaitForAeJS()}),AEJSWP.reloadAeJSFramework=function(e){if(AEJSWP.aeJS.settings.auth_window)AEJSWP.debugOutput("Starting auth flow with provider = "+e),AEJSWP.aeJS.trigger.authenticate(e,"register");else{AEJSWP.debugOutput("Redirect flow, so re-loading aeJS framework to pick up changed settings");var t=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.src=AEJSWP.ae_js_path,t.appendChild(r),AEJSWP.ae_framework_reloaded=!0,AEJSWP.auth_service_after_reload=e}},AEJSWP.userHandler=function(e,t){if(AEJSWP.debugOutput("userHandler: "+t,e),AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress"))AEJSWP.debugOutput("Doing nothing, password reset flow in progress");else if("disabled"!=AEJSWP.sso_type||AEJSWP.getSessionStorageItem("aejswp_ae_login_fired")){if(void 0!==e&&void 0!==e.data){if(AEJSWP.onUserSSOLogin())return AEJSWP.debugOutput("onUser SSO attempt"),void AEJSWP.loginHandler(e,"login",!0);if(AEJSWP.getLocalStorageItem("aejswp_cform_id"))return void("init"!=t&&"update"!=t||AEJSWP.customFormValidation(e));AEJSWP.disable_logged_in_session&&(AEJSWP.debugOutput("Logged-in session disabled in performance settings"),AEJSWP.ajaxUpdateState(e)),AEJSWP.authConnect(e)}}else void 0!==e&&void 0!==e.data&&AEJSWP.authConnect(e)},AEJSWP.loginHandler=function(e,t,r){if(AEJSWP.debugOutput("loginHandler: "+t+" (sso="+r+")",e),AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress"))AEJSWP.debugOutput("Doing nothing, password reset flow in progress");else if(AEJSWP.setSessionStorageItem("aejswp_ae_login_fired",!0),AEJSWP.ae_login_fired=!0,"registration"==t&&AEJSWP.trackEvent("registration",e),"auth"==t&&(AEJSWP.trackEvent("accountConnect",e),AEJSWP.authConnect(e)),!AEJSWP.custom_form_complete){if(AEJSWP.getLocalStorageItem("aejswp_cform_id")&&("login"==t||"registration"==t))return void AEJSWP.customFormValidation(e);("login"==t||"registration"==t||"auth"==t&&!AEJSWP.user_logged_in)&&AEJSWP.logUserIn(e)}},AEJSWP.flowHandler=function(e){if(AEJSWP.debugOutput("flowHandler: ",e),void 0!==e.step)if(AEJSWP.getLocalStorageItem("aejswp_cform_id")){AEJSWP.ae_form_submit_in_progress=!1;r=AEJSWP.getLocalStorageItem("aejswp_cform_id");if("verify-email"==e.step&&(AEJSWP.debugOutput("User still needs to verify their email"),AEJSWP.setSessionStorageItem("aejswp_verify_email_in_progress",AEJSWP.aeJS.user.data.Email),AEJSWP.displayVerifyEmail(r,AEJSWP.aeJS.user.data.Email),AEJSWP.getSessionStorageItem("aejswp_verify_email_sent")||(AEJSWP.setSessionStorageItem("aejswp_verify_email_sent",!0),AEJSWP.sendVerifyEmail(AEJSWP.aeJS.user.data.Email))),"required-fields"==e.step)if(AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress"))AEJSWP.debugOutput("User still in password reset flow - so not showing additional details form, they must login first");else{AEJSWP.debugOutput("User missing required fields"),AEJSWP.addAEHandlerBackToCustomForm(AEJSWP.getLocalStorageItem("aejswp_cform_id")),AEJSWP.hideCaptchaOnForm(AEJSWP.getLocalStorageItem("aejswp_cform_id")),AEJSWP.redirectToCustomFormPage(r);var t=AEJSWP.checkUserRequiredFields(r,AEJSWP.aeJS.user);AEJSWP.displayAdditionalDetailsForm(r,t),AEJSWP.updateCustomForms()}if("error"===e.step){if(e.error=e.error.replace(/\+/g," "),e.error=e.error.replace(/\%2F/g,"/"),e.error.includes("Email account already exists with a different password")){AEJSWP.debugOutput("That user already exists - please use the login form instead");if((o=jQuery("#ae-cform-email-reg-"+AEJSWP.getLocalStorageItem("aejswp_cform_id"))).length&&AEJSWP.setFormError(o,AEJSWP.custom_forms[AEJSWP.getLocalStorageItem("aejswp_cform_id")].flow_labels.form_error_account_exists),!AEJSWP.aeJS.settings.auth_window){var r=AEJSWP.getLocalStorageItem("aejswp_cform_id");AEJSWP.displayRegistrationForm(r),jQuery("#ae-cform-email-container-"+r).slideToggle()}}if(e.error.includes("No account exists with those credentials")){AEJSWP.debugOutput("Incorrect email and/or password");(o=jQuery("#ae-cform-email-login-"+AEJSWP.getLocalStorageItem("aejswp_cform_id"))).length&&AEJSWP.setFormError(o,AEJSWP.custom_forms[AEJSWP.getLocalStorageItem("aejswp_cform_id")].flow_labels.form_error_no_account),AEJSWP.aeJS.settings.auth_window||jQuery("#ae-cform-email-container-"+AEJSWP.getLocalStorageItem("aejswp_cform_id")).slideToggle()}if(e.error.includes("Missing required username and/or password")){AEJSWP.debugOutput("Missing required username and/or password");var o=jQuery("#ae-cform-email-login-"+AEJSWP.getLocalStorageItem("aejswp_cform_id"));o.length&&AEJSWP.setFormError(o,AEJSWP.custom_forms[AEJSWP.getLocalStorageItem("aejswp_cform_id")].flow_labels.form_error_no_account),AEJSWP.aeJS.settings.auth_window||jQuery("#ae-cform-email-container-"+AEJSWP.getLocalStorageItem("aejswp_cform_id")).slideToggle()}e.error.includes("authentication denied")&&AEJSWP.debugOutput("Social Auth denied")}}else"register"==e.step&&AEJSWP.trackEvent("registrationModalShown",AEJSWP.widget_cta),"login"==e.step&&AEJSWP.trackEvent("loginModalShown",AEJSWP.widget_cta)},AEJSWP.emailVerifyHandler=function(e,t){if(AEJSWP.debugOutput("emailVerifyHandler: "+e,t),""!=AEJSWP.getQueryStringValue("password_reset")&&AEJSWP.setSessionStorageItem("aejswp_cform_id",parseInt(AEJSWP.getQueryStringValue("password_reset"))),AEJSWP.getLocalStorageItem("aejswp_cform_id")&&void 0!==e){if("sent"==e&&AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress")){AEJSWP.displayPasswordResetEmailSent();(o=jQuery("#ae-cform-reset-password-step1-"+AEJSWP.getLocalStorageItem("aejswp_cform_id"))).length&&AEJSWP.hideFormError(o),AEJSWP.clearPasswordResetState()}if("verified"==e&&(AEJSWP.debugOutput("User returned after succesful email verification"),AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress"))){AEJSWP.debugOutput("Storing verify email return data for password reset"),AEJSWP.setSessionStorageItem("aejswp_password_reset_email",t.EmailAddress),AEJSWP.setSessionStorageItem("aejswp_password_reset_member_service_id",t.MemberServiceID),1==parseInt(AEJSWP.custom_forms[AEJSWP.getLocalStorageItem("aejswp_cform_id")].modal_display)&&AEJSWP.setSessionStorageItem("aejswp_password_reset_force_modal_open",!0),AEJSWP.debugOutput("Logging user out of their AE session, to stop stop SSO login on page refresh"),AEJSWP.aeJS.trigger.logout();var r=AEJSWP.removeURLParameter(window.location.href,"password_reset");r=AEJSWP.removeURLParameter(r,"step"),r=AEJSWP.removeURLParameter(r,"code"),window.location.href=r}if("error"==e&&void 0!==t.code&&169==t.code){AEJSWP.debugOutput("Users password reset email is invalid");var o=jQuery("#ae-cform-reset-password-step1-"+AEJSWP.getLocalStorageItem("aejswp_cform_id"));o.length&&AEJSWP.setFormError(o,AEJSWP.custom_forms[AEJSWP.getLocalStorageItem("aejswp_cform_id")].flow_labels.form_error_email_not_found)}}},AEJSWP.passwordResetHandler=function(e,t){AEJSWP.debugOutput("passwordResetHandler: "+e,t),AEJSWP.getLocalStorageItem("aejswp_cform_id")&&void 0!==e&&"ok"==e&&(AEJSWP.displayPasswordResetSuccess(),AEJSWP.clearPasswordResetState(),AEJSWP.debugOutput("Logging user out of their AE session, in readyness for a fresh login after password reset"),AEJSWP.aeJS.trigger.logout())},AEJSWP.mobileDetectHandler=function(){AEJSWP.debugOutput("mobileDetectHandler fired"),AEJSWP.aeJS.settings.auth_window=!1},AEJSWP.windowHandler=function(e){AEJSWP.debugOutput("windowHandler: ",e)},AEJSWP.logoutHandler=function(e){AEJSWP.debugOutput("logoutHandler: ",e)},AEJSWP.incognitoHandler=function(e,t){AEJSWP.detect_safari_incognito()||!AEJSWP.detect_cookies_enabled()?(e.stopImmediatePropagation(),jQuery("body").append('<div id="ae-browser-config-error" style="display:none;">'+(AEJSWP.detect_safari_incognito()?AEJSWP.safari_incognito_error:AEJSWP.cookies_disabled_error)+"</div>"),jQuery("#ae-browser-config-error").modal()):"ae-widget"==t&&AEJSWP.trackEvent("registrationModalShown",AEJSWP.widget_cta)},AEJSWP.logUserIn=function(e,t){if(t=t||!1,!AEJSWP.user_logging_in){AEJSWP.user_logging_in=!0,AEJSWP.debugOutput("User logged in to AE, performing WP plugin follow on actions..."),AEJSWP.trackEvent("login",e);var r=AEJSWP.getQueryStringValue("aewperror");if(""==r)if(AEJSWP.user_logged_in)AEJSWP.debugOutput("Doing nothing, user already logged-in");else if(AEJSWP.ajax_login){var o=t?AEJSWP.getUserOptinChoices(t):[];AEJSWP.ajaxLogin(e,o,t)}else{if(AEJSWP.disable_wp_user_record)return AEJSWP.debugOutput("WP user record disabled"),t&&AEJSWP.sendUserOptins(t,e.data,AEJSWP.getUserOptinChoices(t)),void AEJSWP.ajaxUpdateState(e);if(AEJSWP.disable_logged_in_session&&(AEJSWP.debugOutput("Logged-in session disabled"),!AEJSWP.aeJS.settings.auth_window&&!t))return void AEJSWP.debugOutput("User has already been through redirect login handler, which will have created the WP record, doing nothing");AEJSWP.maybe_wait_for_event("send_user_optins",function(){var r=t?AEJSWP.getUserOptinChoices(t):[],o=AEJSWP.getUserUpdatedOptins(t,r);if(o){e.data=AEJSWP.run_filter("filter__optin_user_data",e.data);var a={cform_id:t,user_data:e.data,optins:o};AEJSWP.trackEvent("optinsUpdated",a)}AEJSWP.redirectLogin(e,r,t)})}else AEJSWP.debugOutput("Doing nothing, aewperror="+r+" detected in query string")}},AEJSWP.ajaxLogin=function(e,t,r){void 0===e.services&&(e.services=[]),r=r||!1;var o=window.location.href;o=AEJSWP.removeURLParameter(o,"password_reset"),AEJSWP.maybe_wait_for_event("send_user_optins",function(){var t=AEJSWP.run_filter("filter__optin_user_data",e.data),a=a||[],s={action:AEJSWP.ajax_action_login,data:t,services:e.services,current_page:o,optins:a,cform_id:r};AEJSWP.disable_wp_user_record?(AEJSWP.debugOutput("WP user record disabled, not making AJAX request to login"),r&&AEJSWP.sendUserOptins(r,t,AEJSWP.getUserOptinChoices(r)),""!=AEJSWP.login_redirect_url?(AEJSWP.debugOutput("Post login redirect specified, redirecting to: "+AEJSWP.login_redirect_url),window.location.href=AEJSWP.login_redirect_url):(AEJSWP.debugOutput("Updating state via AJAX"),AEJSWP.ajaxUpdateState(e))):(AEJSWP.debugOutput("WP Login AJAX request : ",s),jQuery.post(AEJSWP.ajaxurl,s,function(t){try{if(0==(t=jQuery.parseJSON(t)).status)6==t.fail_status&&(t.message=t.message.replace(new RegExp("<br/>","g"),"\n"),alert(t.message)),console.log("AEJSWP Error: WP Login AJAX response : ",t);else{AEJSWP.debugOutput("WP Login AJAX response : ",t);var o=AEJSWP.getUserUpdatedOptins(r,a);if(o){var s={cform_id:r,user_data:e.data,optins:o};AEJSWP.trackEvent("optinsUpdated",s)}""!=AEJSWP.login_redirect_url?(AEJSWP.debugOutput("Post login redirect specified, redirecting to: "+AEJSWP.login_redirect_url),window.location.href=AEJSWP.login_redirect_url):(AEJSWP.debugOutput("Updating state via AJAX"),AEJSWP.ajaxUpdateState(e),AEJSWP.disable_logged_in_session||(AEJSWP.debugOutput("Setting user_logged_in to true & making AJAX request to get an updated logout URL"),AEJSWP.user_logged_in=!0,AEJSWP.getLogoutURL()),AEJSWP.authConnect(e))}}catch(e){console.log("AEJSWP Error: WP Login AJAX response : ",t)}}))})},AEJSWP.redirectLogin=function(e,t,r){var o=e.data.AccessToken,t=t||[],a=encodeURIComponent(JSON.stringify(t)),s=window.location.href;s=AEJSWP.removeURLParameter(s,"accessToken"),s=AEJSWP.removeURLParameter(s,"password_reset");var i=""!=AEJSWP.login_redirect_url?AEJSWP.login_redirect_url:s;i=AEJSWP.run_filter("filter__redirect_login_return_url",i),i=encodeURIComponent(i);var n=AEJSWP.ajaxurl+"?action="+AEJSWP.redirect_action_login+"&accessToken="+o+"&optins="+a+"&cform_id="+r+"&return_url="+i;AEJSWP.debugOutput("Redirect Login, redirecting to: "+n),window.location.href=n},AEJSWP.getLogoutURL=function(){var e={action:AEJSWP.ajax_action_get_logout_url,return_url:window.location.href};AEJSWP.debugOutput("WP get_logout_url AJAX request",e),jQuery.post(AEJSWP.ajaxurl,e,function(e){AEJSWP.debugOutput("WP get_logout_url AJAX response : ",e),""!=(e=jQuery.parseJSON(e)).wp_logout_url&&(AEJSWP.wp_logout_url=e.wp_logout_url)})},AEJSWP.onUserSSOLogin=function(){var e=AEJSWP.getSessionStorageItem("aewpjs_sso_attempted");if("disabled"!=AEJSWP.sso_type&&!AEJSWP.user_logged_in&&!e){var t=AEJSWP.getQueryStringValue("aewperror");if(""==t)return AEJSWP.setSessionStorageItem("aewpjs_sso_attempted",!0),!0;AEJSWP.debugOutput("onUser SSO login attempt failed, WP returned error: "+AEJSWP.login_fail_status_messages[t])}return!1},AEJSWP.ajaxUpdateState=function(e){void 0!==e.data&&(AEJSWP.debugOutput("Updating logged in state without page refresh, using the aeJS user object"),AEJSWP.authConnect(e),jQuery("."+AEJSWP.ajax_update_class).each(function(t,r){var o=jQuery(this).data("aewp-no-salutation"),a=jQuery(this).data("aewp-no-profile-link"),s=jQuery(this).data("aewp-no-logout-link"),i="";o||(i+='<span class="ae-wp-salutation">',i+=AEJSWP.logged_in_salutation.replace("{USERNAME}",e.data.Username),i+="</span>"),a||(i+='<span class="ae-wp-profile-link">',i+='<a href="'+AEJSWP.profile_link_url+'">'+AEJSWP.profile_link.replace("{USERNAME}",e.data.Username)+"</a>",i+="</span>"),s||(i+='<span class="ae-wp-logout-link">',i+='<a class="ae-wp-logout-anchor" href="#" onclick="AEJSWP.logout();">'+AEJSWP.logout_link+"</a>",i+="</span>"),jQuery(this).html(i)}))},AEJSWP.redirectFlowSigninErrorCheck=function(){if(6==AEJSWP.getQueryStringValue("aewperror")){var e=!1;if("undefined"!=typeof Storage&&AEJSWP.getSessionStorageItem("aewpjs_login_error_status_6_displayed")&&(e=AEJSWP.getSessionStorageItem("aewpjs_login_error_status_6_displayed")),!e){"undefined"!=typeof Storage&&(e=AEJSWP.setSessionStorageItem("aewpjs_login_error_status_6_displayed",!0),sso_attempted=AEJSWP.setSessionStorageItem("aewpjs_sso_attempted",!0));var t=AEJSWP.login_fail_status_messages[6].replace(new RegExp("<br/>","g"),"\n");alert(t)}}},AEJSWP.authConnect=function(e){void 0!==e&&void 0!==e.data&&(AEJSWP.debugOutput("Updating Auth Connect anchors: ",e),jQuery(".ae-wp-auth-connect-container").each(function(t,r){var o=jQuery(".ae-wp-authenticator-anchor",jQuery(this)),a=o.attr("data-ae-register-link"),s=o.attr("data-ae-login-link"),i=void 0!==o.attr("ae-wp-connect-provider")?o.attr("ae-wp-connect-provider"):o.attr("ae-wp-provider"),n=null,u="";if(void 0!==a&&!1!==a?(n=a,u="data-ae-register-link"):void 0!==s&&!1!==s?(n=s,u="data-ae-login-link"):void 0!==i&&!1!==i&&(n=i),n)if(AEJSWP.providerExistsInServices(e.services,n)){if(jQuery(this).trigger("ae-wp-auth-connected"),jQuery(this).addClass("ae-wp-auth-connected"),AEJSWP.auth_connected.length>0){var d='<span class="ae-wp-auth-connected-message">';d+=AEJSWP.auth_connected,d+="</span>",jQuery(this).html(d)}}else""!==u&&(o.removeAttr(u),o.attr("ae-wp-connect-provider",n))}))},AEJSWP.addAuthenticatorClickHandler=function(){jQuery(".ae-wp-authenticator-anchor").click(function(e){e.preventDefault();var t=AEJSWP.aeJS.settings.return_url;jQuery(this).hasClass("ae-disabled-login-hook")&&(t+="&disable-login-hook=true",AEJSWP.aeJS.settings.return_url=t,AEJSWP.login_redirect_url=t,AEJSWP.debugOutput("AE Auth Connect Triggered. Login hook has been disabled. Return URL:",t));var r=jQuery(this).attr("ae-wp-connect-provider");void 0!==r&&!1!==r?(t+="&auth-connect=true",AEJSWP.debugOutput("AE Auth Connect Triggered. Return URL:",t),AEJSWP.aeJS.settings.return_url=t,AEJSWP.aeJS.trigger.authenticate(r,"auth")):(void 0===(r=jQuery(this).attr("ae-wp-provider"))&&(r=jQuery(this).attr("data-ae-register-link")),void 0===r&&(r=jQuery(this).attr("data-ae-login-link")),AEJSWP.aeJS.trigger.authenticate(r,"auth"))})},AEJSWP.trackEvent=function(e,t){switch(e){case"loginModalShown":AEJSWP.debugOutput("Firing loginModalShown event with data: ",String(t)),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".loginModalShown",window,String(t));break;case"registrationModalShown":AEJSWP.debugOutput("Firing registrationModalShown event with data: ",String(t)),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".registrationModalShown",window,String(t));break;case"login":var r=t,o={service_name:(a=AEJSWP.getLastLoginService(r.services)).Service,service_user_id:a.ID,ae_user_id:r.data.ID,ae_user_data:r};AEJSWP.debugOutput("Firing login event with data: ",o),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".login",window,o);break;case"registration":var r=t,o={service_name:(a=AEJSWP.getLastLoginService(r.services)).Service,service_user_id:a.ID,ae_user_id:r.data.ID,ae_user_data:r};AEJSWP.debugOutput("Firing registration event with data: ",o),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".registration",window,o);break;case"formErrors":AEJSWP.debugOutput("Firing formErrors event with data: ",t),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".formErrors",window,t);break;case"accountConnect":var r=t,a=AEJSWP.getLastLoginService(r.services),o={service_name:a.Service,service_user_id:a.ID,ae_user_id:r.data.ID,ae_user_data:r};AEJSWP.debugOutput("Firing accountConnect event with data: ",o),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".accountConnect",window,o);break;case"optinsUpdated":AEJSWP.debugOutput("Firing optinsUpdated event with data: ",t),AEJSWP.executeFunctionByName(AEJSWP.analytics_tracking_delegate+".optinsUpdated",window,t)}},AEJSWP.fireFormErrorsEvent=function(e,t){"registration"!=e&&"login"!=e&&"mailinglist"!=e&&(e="login");var r={};r.form_errors=t,r.form_type=e,AEJSWP.trackEvent("formErrors",r)},AEJSWP.detect_safari_incognito=function(){var e=navigator.userAgent.indexOf("Chrome")>-1;if(navigator.userAgent.indexOf("Safari")>-1&&!e)try{var t="aejswp_test_item";localStorage.setItem(t,t),localStorage.removeItem(t)}catch(e){return!0}return!1},AEJSWP.detect_cookies_enabled=function(){if(!navigator.cookieEnabled)return!1;document.cookie="aejswp_test_cookie=1";var e=-1!==document.cookie.indexOf("aejswp_test_cookie=");return document.cookie="aejswp_test_cookie=; expires=Thu, 01 Jan 1970 00:00:00 UTC",e},AEJSWP.display_browser_config_error=function(e){var t="",r="";switch(e){case"safari_incognito":t="ae-cform-safari-incognito-error",r=AEJSWP.safari_incognito_error;break;case"cookies_disabled":t="ae-cform-cookies-disabled-error",r=AEJSWP.cookies_disabled_error}jQuery(".ae-cform-modal-container").length>0?(jQuery(".ae-cform-modal-container").css("position","relative"),jQuery(".ae-cform-modal-container, .ae-modal").prepend('<div class="'+t+'" style="display:none;"><p><span><span>'+r+"</span></span></p></div>")):(jQuery(".ae-cform-container").css("position","relative"),jQuery(".ae-cform-container, .ae-modal").prepend('<div class="'+t+'"  style="display:none;"><p><span><span>'+r+"</span></span></p></div>")),jQuery(".ae-cform-container").length>0&&jQuery(".ae-cform-container").height()<200&&jQuery("."+t+" p span span").css("font-size","0.85em"),setTimeout(function(){jQuery("."+t).show()},1)},AEJSWP.customFormEvent=!1,AEJSWP.customFormEventFormID=!1,AEJSWP.customFormSubmit=function(e,t){if("undefined"!=typeof grecaptcha&&!AEJSWP.custom_forms[e].captchaVerified)return AEJSWP.customFormEvent=t,AEJSWP.customFormEventFormID=e,AEJSWP.debugOutput("Recaptcha activated"),t.preventDefault(),void grecaptcha.execute();AEJSWP.debugOutput("User submitted custom form "+e);var r=parseInt(AEJSWP.custom_forms[e].type_id);AEJSWP.applyCustomFormSettings(e);var o=AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0)?AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0):[],a=(o[e],1==o[e]),s=AEJSWP.getSessionStorageItem("aejswp_user_casl_in_progress")==e;if(void 0!==t&&!a&&s&&(AEJSWP.debugOutput("User completed CASL compliance flow, updating state"),o[e]=!0,AEJSWP.removeSessionStorageItem("aejswp_user_casl_in_progress"),AEJSWP.setLocalStorageItem("aejswp_user_casl_completed",o,!0)),void 0===t||2!=r||void 0!==AEJSWP.aeJS.user.data||jQuery(".parsley-error",i).length||(AEJSWP.debugOutput("Mailing list form submission click without an AE user"),t.preventDefault(),AEJSWP.mailingListFormValidation(e)),void 0!==t&&1==r){AEJSWP.debugOutput("Registration form - running parsley validation");var i=jQuery("#ae-cform-email-reg-"+e);if(i.parsley().validate(),jQuery(".parsley-error",i).length){AEJSWP.debugOutput("Parsley errors - registration form not yet complete, preventing AE submit"),t.preventDefault();var n=[];return jQuery(".parsley-errors-list li",i).each(function(){var e=jQuery(this)[0].innerHTML;n.push(e)}),void AEJSWP.fireFormErrorsEvent("registration",n)}if(AEJSWP.debugOutput("No parsley errors"),!AEJSWP.minimumAgeCheck(e))return void t.preventDefault();if(void 0!==AEJSWP.custom_forms[e].form_fields.captcha)if(AEJSWP.debugOutput("Registration form has a captcha."),void 0!==AEJSWP.aeJS.user.data)AEJSWP.debugOutput("Authenticated user session found, captcha check not applied");else{if(!AEJSWP.custom_forms[e].captchaVerified)return AEJSWP.debugOutput("Registration form captcha not validated, preventing AE submit"),t.preventDefault(),AEJSWP.setFormError(i,AEJSWP.custom_forms[e].flow_labels.form_error_captcha_incomplete),void AEJSWP.fireFormErrorsEvent("registration",[AEJSWP.custom_forms[e].flow_labels.form_error_captcha_incomplete]);AEJSWP.debugOutput("Form captcha validated"),AEJSWP.hideFormError(i)}else AEJSWP.debugOutput("No captcha on form");void 0===AEJSWP.ae_form_submit_in_progress||0==AEJSWP.ae_form_submit_in_progress?(AEJSWP.ae_form_submit_in_progress=!0,AEJSWP.debugOutput("Submitting form to AE"),AEJSWP.aeJS.trigger.submit(t.target.form)):AEJSWP.debugOutput("Stopping form submit as user has previously clicked the submit button, still waiting on response from AE")}},AEJSWP.applyCustomFormSettings=function(e,t){var r=parseInt(AEJSWP.custom_forms[e].type_id);AEJSWP.debugOutput("Applying Custom Form settings for cform_id = "+e+", cform_type_id = "+r),AEJSWP.setLocalStorageItem("aejswp_cform_id",e),AEJSWP.setSessionStorageItem("aejswp_cform_prev_return_url")||(AEJSWP.setSessionStorageItem("aejswp_cform_prev_return_url",AEJSWP.aeJS.settings.return_url),AEJSWP.setSessionStorageItem("aejswp_cform_prev_auth_window",AEJSWP.aeJS.settings.auth_window),AEJSWP.setSessionStorageItem("aejswp_cform_prev_extra_fields",AEJSWP.aeJS.settings.extra_fields,!0)),AEJSWP.aeJS.settings.display_error_message=!1,AEJSWP.aeJS.settings.extra_fields_screen=!1,AEJSWP.aeJS.settings.verify_email=!1,0==AEJSWP.aeJS.settings.auth_window&&(AEJSWP.aeJS.settings.return_url=""!=AEJSWP.custom_forms[e].page_url?AEJSWP.custom_forms[e].page_url:window.location.href);var o="",a=AEJSWP.custom_forms[e].signin_options;for(var s in a)""!=a[s]["ae-service"]&&(o+=a[s]["ae-service"]+",");o=o.replace(/,\s*$/,""),AEJSWP.aeJS.settings.services=o,AEJSWP.aeJS.settings.extra_fields={};for(var s in AEJSWP.custom_forms[e].form_fields)if("password"!=s&&"captcha"!=s){var i=AEJSWP.custom_forms[e].form_fields,n="1"==Object.values(i[s])[0];AEJSWP.aeJS.settings.extra_fields[s]="email"==s||n?{label:s,required:!0}:{label:s,required:!1}}AEJSWP.debugOutput("Modified aeJS",AEJSWP.aeJS.settings),void 0!==t&&(t.preventDefault(),void 0===AEJSWP.ae_form_submit_in_progress||0==AEJSWP.ae_form_submit_in_progress?(AEJSWP.ae_form_submit_in_progress=!0,AEJSWP.debugOutput("Submitting form to AE"),AEJSWP.aeJS.trigger.submit(t.target.form)):AEJSWP.debugOutput("Stopping form submit as user has previously clicked the submit button, still waiting on response from AE"))},AEJSWP.customFormValidation=function(e){AEJSWP.debugOutput("Custom form validation");var t=AEJSWP.getLocalStorageItem("aejswp_cform_id"),r=AEJSWP.checkUserRequiredFields(t,e);if(r.length>0)return AEJSWP.ae_login_fired&&(AEJSWP.ae_login_fired=!1,AEJSWP.redirectToCustomFormPage(t)),void AEJSWP.displayAdditionalDetailsForm(t,r);if(AEJSWP.verify_email&&!AEJSWP.userHasVerifiedEmail())return AEJSWP.debugOutput("Verified Email required, but missing"),AEJSWP.setSessionStorageItem("aejswp_verify_email_in_progress",e.data.Email),AEJSWP.displayVerifyEmail(t,e.data.Email),void AEJSWP.sendVerifyEmail(e.data.Email);switch(AEJSWP.custom_form_complete=!0,1==parseInt(AEJSWP.custom_forms[t].modal_display)&&jQuery.modal.close(),AEJSWP.clearCustomFormState(!0),parseInt(AEJSWP.custom_forms[t].type_id)){case 1:AEJSWP.debugOutput("Finished registration custom form"),AEJSWP.logUserIn(e,t);break;case 2:AEJSWP.debugOutput("Finished mailing list custom form"),AEJSWP.mailingListFormComplete(t,e.data)}},AEJSWP.checkUserRequiredFields=function(e,t){AEJSWP.debugOutput("Checking user record for required fields on cform "+e);var r=[],o=AEJSWP.custom_forms[e].form_fields;for(var a in o){var s=Object.keys(o[a])[0],i=1==Object.values(o[a])[0];if("password"!=a&&"captcha"!=a&&i)if(void 0===t.data[s]||""==t.data[s]||null==t.data[s]||"Unknown"==t.data[s])r.push(a);else if("country"==a){var n="1"==AEJSWP.custom_forms[e].opt_ins_casl_enabled,u=0!=Object.keys(AEJSWP.custom_forms[e].opt_ins).length,d=void 0!==t.data.CountryCode&&"CA"==t.data.CountryCode||void 0!==t.data.Country&&"Canada"==t.data.Country||void 0!==t.data.GeoCountry&&"CA"==t.data.GeoCountry,c=AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0)?AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0):[],l=(c[e],1==c[e]);n&&u&&d&&!l&&(AEJSWP.debugOutput("User is from Canada and has not yet completed CASL flow - forcibly adding country to missing fields & updating opt-ins for CASL compliance"),r.push("country"),AEJSWP.updateCaslLabels(!0),AEJSWP.setSessionStorageItem("aejswp_user_casl_in_progress",e))}else"birthdate"==a&&(AEJSWP.minimumAgeCheck(e)||r.push(a))}return r.length>0&&AEJSWP.debugOutput("User is missing fields: "+r),r},AEJSWP.minimumAgeCheck=function(e){if(AEJSWP.minimum_age){AEJSWP.debugOutput("Minimum age of "+AEJSWP.minimum_age+" required");var t=jQuery("#ae-cform-input-reg-birthdate-"+e).val();void 0!==t&&""!=t&&"undefined"!=t&&parseInt(t)==parseInt(t)||(AEJSWP.debugOutput("no dob field on form, using dob from user record"),t=void 0!==AEJSWP.aeJS.user.data&&void 0!==AEJSWP.aeJS.user.data.BirthDate?AEJSWP.aeJS.user.data.BirthDate:new Date),t=new Date(t);var r=new Date,o=Math.floor((r-t)/31536e6);if(AEJSWP.debugOutput("User is "+o),o<=AEJSWP.minimum_age){AEJSWP.debugOutput("User is not old enough");var a=AEJSWP.custom_forms[e].flow_labels.form_error_age_check_fail;a=a.replace("{AGE}",AEJSWP.minimum_age);var s=jQuery("#ae-cform-email-reg-"+e);return AEJSWP.setFormError(s,a),1==parseInt(AEJSWP.custom_forms[e].type_id)?AEJSWP.fireFormErrorsEvent("registration",[a]):AEJSWP.fireFormErrorsEvent("mailinglist",[a]),!1}}return!0},AEJSWP.displayAdditionalDetailsForm=function(e,t){AEJSWP.debugOutput("Displaying additional details form");var r=AEJSWP.custom_forms[e].form_fields;for(var o in r){var a=o;-1==t.indexOf(a)&&(jQuery("#ae-cform-reg-item-"+a+"-"+e).remove(),"password"==a&&jQuery("#ae-cform-reg-item-password-confirm-"+e).remove())}AEJSWP.updateCustomForms(),jQuery("#ae-cform-title-"+e).html(AEJSWP.custom_forms[e].flow_labels.additional_info_title),jQuery("#ae-cform-signin-options-"+e).hide(),jQuery("#ae-cform-email-container-"+e).show(),jQuery("#ae-cform-email-reg-container-"+e).show(),jQuery("#ae-cform-email-login-container-"+e).hide(),jQuery("#ae-cform-already-registered-link-"+e).hide()},AEJSWP.redirectToCustomFormPage=function(e){var t=AEJSWP.custom_forms[e].page_url;return""!=t&&-1==window.location.href.indexOf(t)&&(AEJSWP.debugOutput("Redirecting user to custom form page: "+t),window.location.href=t,!0)},AEJSWP.mailingListFormValidation=function(e){AEJSWP.debugOutput("Mailing list form submit");var t=jQuery("#ae-cform-email-reg-"+e),r=AEJSWP.custom_forms[e].form_fields,o=!0;for(var a in r){var s="1"==Object.values(r[a]);if("password"!=a&&"captcha"!=a){var i=jQuery("#ae-cform-reg-item-"+a+"-"+e+" :input").val();AEJSWP.debugOutput(a+" = "+i),""==i&&s&&(o=!1),"email"==a&&""==i&&(o=!1)}}if(AEJSWP.minimumAgeCheck(e)){if(void 0!==AEJSWP.custom_forms[e].form_fields.captcha){if(AEJSWP.debugOutput("Email form has a captcha."),!AEJSWP.custom_forms[e].captchaVerified)return AEJSWP.debugOutput("Captcha not complete / validated."),AEJSWP.setFormError(t,AEJSWP.custom_forms[e].flow_labels.form_error_captcha_incomplete),void AEJSWP.fireFormErrorsEvent("mailinglist",[AEJSWP.custom_forms[e].flow_labels.form_error_captcha_incomplete]);AEJSWP.debugOutput("Captcha complete.")}if(o){AEJSWP.debugOutput("Mailing List Form complete, next steps...");var n=AEJSWP.getNonAEUserDetails(e);AEJSWP.mailingListFormComplete(e,n)}else AEJSWP.debugOutput("Mailing List Form incomplete"),AEJSWP.setFormError(t,AEJSWP.custom_forms[e].flow_labels.form_error_incomplete),AEJSWP.fireFormErrorsEvent("mailinglist",[AEJSWP.custom_forms[e].flow_labels.form_error_incomplete])}},AEJSWP.getNonAEUserDetails=function(e){var t={},r=AEJSWP.custom_forms[e].form_fields;for(var o in r)if("password"!=o&&"captcha"!=o){var a=jQuery("#ae-cform-reg-item-"+o+"-"+e+" :input").val(),s=r[o];t[Object.keys(s)[0]]=a}return AEJSWP.debugOutput("Non AE User data",t),t},AEJSWP.mailingListFormComplete=function(e,t){AEJSWP.debugOutput("Mailing list completed, cform_id = "+e);var r=AEJSWP.getLocalStorageItem("aeswp_cform_mailing_lists_completed",!0);r.push(e),AEJSWP.setLocalStorageItem("aeswp_cform_mailing_lists_completed",r,!0),AEJSWP.maybe_wait_for_event("send_user_optins",function(){var r=AEJSWP.getUserOptinChoices(e);AEJSWP.sendUserOptins(e,t,r),AEJSWP.displayMailingListSuccess(e),AEJSWP.executeFunctionByName("AEJSWP.mailingListFormCompleteCallback",window,e)})},AEJSWP.displayMailingListSuccess=function(e){AEJSWP.debugOutput("Mailing list form "+e+" completed");var t=jQuery("#ae-cform-container-"+e);if(t.length)if(t.attr("data-custom-cta")){var r=jQuery(".ae-custom-cta");r.length&&jQuery(r).each(function(){var e=AEJSWP.getCustomCTAFormID(jQuery(this)),t=jQuery("#ae-cform-mailing-list-success-"+e).html();t.length?jQuery(this).replaceWith(t):jQuery(this).remove()})}else t.html(jQuery("#ae-cform-mailing-list-success-"+e).html()),t.addClass("ae-cform-mailing-list-success-"+e);1==parseInt(AEJSWP.custom_forms[e].modal_display)&&jQuery.modal.close()},AEJSWP.addAEHandlerBackToCustomForm=function(e){void 0!==AEJSWP.aeJS.user.data&&(AEJSWP.debugOutput("AE user detected, adding AE handler back to any custom forms"),jQuery("#ae-cform-email-reg-"+e).attr("data-ae-register-form","email"),AEJSWP.aeJS.trigger.attach())},AEJSWP.displayVerifyEmail=function(e,t){jQuery("#ae-cform-verify-email-container-"+e).show();var r=jQuery("#ae-cform-verify-email-container-"+e+" > .ae-cform-verify-email-instructions").html().replace("{USEREMAIL}",t);jQuery("#ae-cform-verify-email-container-"+e+" > .ae-cform-verify-email-instructions").html(r),jQuery("#ae-cform-mailing-list-success-"+e).hide(),jQuery("#ae-cform-title-"+e).hide(),jQuery("#ae-cform-signin-options-"+e).hide(),jQuery("#ae-cform-email-container-"+e).hide(),jQuery("#ae-cform-optins-container-"+e).hide()},AEJSWP.sendVerifyEmail=function(e,t){t=t||!1;AEJSWP.debugOutput("Triggering verify email send to "+e);var r={subject:AEJSWP.aeJS.settings.email_format.verify_email_subject,body:AEJSWP.aeJS.settings.email_format.verify_email_message,label:AEJSWP.aeJS.settings.email_format.verify_email_link},o=window.location.href;if(void 0!==AEJSWP.param_on_return_url_key&&(o=AEJSWP.addURLParameter(o,AEJSWP.param_on_return_url_key,AEJSWP.param_on_return_url_value)),t){r={subject:AEJSWP.aeJS.settings.email_format.reset_pw_email_subject,body:AEJSWP.aeJS.settings.email_format.reset_pw_email_message,label:AEJSWP.aeJS.settings.email_format.reset_pw_email_link};o=AEJSWP.addURLParameter(o,"password_reset",t)}AEJSWP.debugOutput("sendVerifyEmail return_url = "+o),AEJSWP.aeJS.trigger.send_verify_email(o,e,r)},AEJSWP.updateCustomForms=function(){AEJSWP.debugOutput("Updating custom form display states");var e=jQuery.fn.jquery.split(".");parseInt(e[0])<=1&&parseInt(e[1])<8&&(console.log("The version of jQuery on the page is too old for AE Connect custom forms, please upgrade to 1.8.x or better"),jQuery(".ae-cform-container").html("The loaded version of jQuery is too old. Please upgrade to 1.8.x or better.")),jQuery(".ae-cform-container").each(function(){var e=jQuery(this).data("ae-cform-id");void 0!==AEJSWP.custom_forms[e].expanded_email&&0!=parseInt(AEJSWP.custom_forms[e].expanded_email)&&""!=AEJSWP.custom_forms[e].expanded_email&&(AEJSWP.debugOutput("Custom form "+e+" is set to show email form"),jQuery("#ae-cform-email-container-"+e).show(),1==Object.keys(AEJSWP.custom_forms[e].signin_options).length&&jQuery("#ae-cform-signin-options-"+e).hide())});var t=setInterval(function(){jQuery(".grecaptcha-badge").length>0&&(jQuery(".grecaptcha-badge").appendTo("#grecaptcha-badge-cform"),jQuery("#grecaptcha-badge-cform").show(),jQuery(".grecaptcha-badge").css("visibility","visible"),clearInterval(t))},30);if(void 0!==AEJSWP.aeJS&&void 0!==AEJSWP.aeJS.user.data){var r=AEJSWP.aeJS.user.data;for(var o in AEJSWP.custom_forms){var a=AEJSWP.custom_forms[o].form_fields;for(var s in a){var i=Object.keys(a[s])[0];switch(s){case"birthdate":var n=r[i];void 0!==n&&null!==n&&10==n.length&&(jQuery(".ae-cform-item-"+s+" input[name=s_birthdate_day]").val(n.substring(8,10)),jQuery(".ae-cform-item-"+s+" input[name=s_birthdate_month]").val(n.substring(5,7)),jQuery(".ae-cform-item-"+s+" input[name=s_birthdate_year]").val(n.substring(0,4)));break;case"country":void 0!==r.CountryCode?jQuery("#ae-cform-input-reg-country-"+o).val(r.CountryCode):void 0!==r.GeoCountry&&jQuery("#ae-cform-input-reg-country-"+o).val(r.GeoCountry);var u=jQuery("#ae-cform-input-reg-country-"+o).val(),d="1"==AEJSWP.custom_forms[o].opt_ins_casl_enabled;"CA"==u&&d&&(AEJSWP.debugOutput("CASL enabled & user is from Canada, updating opt-ins & terms for CASL compliance"),AEJSWP.updateCaslLabels(!0));break;default:jQuery(".ae-cform-item-"+s+" .ae-cform-input").val(AEJSWP.aeJS.user.data[i])}}}}AEJSWP.updateDOB(),AEJSWP.getLocalStorageItem("aejswp_cform_id")&&void 0!==AEJSWP.aeJS&&void 0!==AEJSWP.aeJS.user.data&&AEJSWP.hideCaptchaOnForm(AEJSWP.getLocalStorageItem("aejswp_cform_id")),AEJSWP.getSessionStorageItem("aejswp_verify_email_in_progress")&&!AEJSWP.userHasVerifiedEmail()&&AEJSWP.displayVerifyEmail(AEJSWP.getLocalStorageItem("aejswp_cform_id"),AEJSWP.getSessionStorageItem("aejswp_verify_email_in_progress")),AEJSWP.getSessionStorageItem("aejswp_password_reset_member_service_id")&&AEJSWP.displayEnterNewPassword(),AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress")||""==AEJSWP.getQueryStringValue("password_reset")||AEJSWP.setSessionStorageItem("aejswp_password_reset_in_progress",!0),AEJSWP.restoreUserOptins();var c=AEJSWP.getLocalStorageItem("aeswp_cform_mailing_lists_completed",!0);if(c)for(var l=0;l<c.length;l++)AEJSWP.displayMailingListSuccess(c[l]);var S=AEJSWP.getSessionStorageItem("aejswp_user_opened_cform_modal_display",!0)?AEJSWP.getSessionStorageItem("aejswp_user_opened_cform_modal_display",!0):[];if((o=AEJSWP.getLocalStorageItem("aejswp_cform_id"))&&S[o]){AEJSWP.debugOutput("Custom form flow still in progress and user has previously opened modal");var m=AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display")?AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display",!0):[],_="undefined"!=m[o]&&"null"!=m[o]&&1==m[o];1==parseInt(AEJSWP.custom_forms[o].modal_display)&&(""!=AEJSWP.getQueryStringValue("password_reset")?AEJSWP.debugOutput("Not re-opening modal, password reset redirect in progress"):AEJSWP.getSessionStorageItem("aejswp_password_reset_force_modal_open")?(AEJSWP.debugOutput("User returning from password reset, so re-opening modal"),jQuery("#ae-cform-modal-container-"+o).modal(),AEJSWP.removeSessionStorageItem("aejswp_password_reset_force_modal_open")):_?AEJSWP.debugOutput("User previously clicked close on this custom from modal, so not re-opening automatically"):(AEJSWP.debugOutput("User has not closed the modal themseleves, so re-opening modal automatically"),jQuery("#ae-cform-modal-container-"+o).modal()))}else o&&1==parseInt(AEJSWP.custom_forms[o].modal_display)&&(AEJSWP.debugOutput("Custom form flow still in progress and custom form is using modal display, but user has not opened it yet"),AEJSWP.getSessionStorageItem("aejswp_password_reset_force_modal_open")&&""!=!AEJSWP.getQueryStringValue("password_reset")&&(AEJSWP.debugOutput("Password reset in progress, so re-opening modal"),jQuery("#ae-cform-modal-container-"+o).modal(),AEJSWP.removeSessionStorageItem("aejswp_password_reset_force_modal_open")))},AEJSWP.restoreUserOptins=function(){var e=AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0);if(e)for(var t=0;t<e.length;t++)if(null!=e[t]){var r=jQuery('.ae-cform-optin-checkbox[data-ae-optin-id="'+t+'"]');if(r.length){var o=r.parents("[data-ae-cform-id]");if(o.length){var a=parseInt(o.attr("data-ae-cform-id"));if(void 0!==AEJSWP.custom_forms[a]){if(1==parseInt(AEJSWP.custom_forms[a].type_id))return}}r.prop("checked",e[t]),AEJSWP.enableRegisterButton(t,e[t])}}},AEJSWP.sendUserOptins=function(e,t,r){var o=AEJSWP.getUserUpdatedOptins(e,r);if(o){AEJSWP.debugOutput("Posting user + optin data for cform_id "+e),t=AEJSWP.run_filter("filter__optin_user_data",t);var a={action:AEJSWP.ajax_action_send_user_optins,cform_id:e,user_data:t,optins:o,confirm_code:"undefined"!=typeof grecaptcha?grecaptcha.getResponse():""};AEJSWP.debugOutput("WP Update User Optins AJAX request : ",a),jQuery.post(AEJSWP.ajaxurl,a,function(r){try{if(0==(r=jQuery.parseJSON(r)).status)console.log("AEJSWP Error: Update User Optins AJAX response : ",r);else{AEJSWP.debugOutput("WP Update User Optins AJAX response : ",r),AEJSWP.removeSessionStorageItem("aejswp_initial_optin_choices");var a={cform_id:e,user_data:t,optins:o};AEJSWP.trackEvent("optinsUpdated",a)}}catch(e){console.log("AEJSWP Error: WP Update User Optins AJAX response : ",r)}})}else AEJSWP.debugOutput("User optins not changed, so not making backend post")},AEJSWP.getUserUpdatedOptins=function(e,t){var r={},o=!1,a=AEJSWP.getSessionStorageItem("aejswp_initial_optin_choices",!0),s=AEJSWP.getLocalStorageItem("aejswp_first_optins_post_completed",!0)?AEJSWP.getLocalStorageItem("aejswp_first_optins_post_completed",!0):[],i=(s[e],1!=s[e]);i&&(AEJSWP.debugOutput("First time user has completed this form, marking all optins for this cform as changed"),o=!0,s[e]=!0,AEJSWP.setLocalStorageItem("aejswp_first_optins_post_completed",s,!0));for(var n in t)"undefined"==a[n]||t[n].user_choice!=a[n]?(o=!0,r[n]=t[n]):i&&(o=!0,r[n]=t[n]);return!!o&&r},AEJSWP.getUserOptinChoices=function(e){AEJSWP.restoreUserOptins();var t=AEJSWP.custom_forms[e].opt_ins,r={};for(var o in t){t[o].user_choice=jQuery("#ac-cform-optin-checkbox-"+e+"-"+t[o].id).is(":checked"),r[o]={optin_id:t[o].id,user_choice:t[o].user_choice};var a=AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0);a[t[o].id]=t[o].user_choice,AEJSWP.setLocalStorageItem("aejswp_optin_choices",a,!0)}return AEJSWP.debugOutput("getUserOptinChoices",r),r},AEJSWP.clearCustomFormState=function(e){doClearState=function(){AEJSWP.debugOutput("Custom Form flow ended, clearing state, immediate = "+e),AEJSWP.aeJS.settings.display_error_message=!0,AEJSWP.aeJS.settings.extra_fields_screen=AEJSWP.extra_fields_screen,AEJSWP.aeJS.settings.extra_fields=AEJSWP.extra_fields,AEJSWP.aeJS.settings.services=AEJSWP.services,AEJSWP.aeJS.settings.return_url=AEJSWP.getSessionStorageItem("aejswp_cform_prev_return_url")?AEJSWP.getSessionStorageItem("aejswp_cform_prev_return_url"):AEJSWP.aeJS.settings.return_url,AEJSWP.aeJS.settings.auth_window=AEJSWP.getSessionStorageItem("aejswp_cform_prev_auth_window")?AEJSWP.getSessionStorageItem("aejswp_cform_prev_auth_window"):AEJSWP.aeJS.settings.auth_window,AEJSWP.aeJS.settings.extra_fields=AEJSWP.getSessionStorageItem("aejswp_cform_prev_extra_fields")?AEJSWP.getSessionStorageItem("aejswp_cform_prev_extra_fields",!0):AEJSWP.aeJS.settings.auth_window,AEJSWP.removeLocalStorageItem("aejswp_cform_id"),AEJSWP.removeSessionStorageItem("aejswp_cform_prev_return_url"),AEJSWP.removeSessionStorageItem("aejswp_cform_prev_auth_window"),AEJSWP.removeSessionStorageItem("aejswp_cform_prev_extra_fields"),AEJSWP.removeSessionStorageItem("aejswp_user_cancelled_cform_modal_display"),AEJSWP.removeSessionStorageItem("aejswp_user_opened_cform_modal_display"),AEJSWP.removeSessionStorageItem("aejswp_verify_email_in_progress"),AEJSWP.removeSessionStorageItem("aejswp_verify_email_sent"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_in_progress"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_email"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_member_service_id"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_force_modal_open"),AEJSWP.removeSessionStorageItem("aejswp_user_casl_in_progress")},AEJSWP.getLocalStorageItem("aejswp_cform_id")&&(e?doClearState():setTimeout(doClearState,1))},AEJSWP.displayPasswordResetEmailSent=function(){var e=AEJSWP.getLocalStorageItem("aejswp_cform_id"),t='<div class="ae-cform-pasword-reset-instruictions-inner">'+AEJSWP.custom_forms[e].flow_labels.reset_password_instructions_sent+"</div>";t+='<div class="ae-cform-form-links"><a href="#" class="ae-cform-reset-password-cancel-link" id="ae-cform-reset-password-cancel-link-'+e+'" href="#" data-ae-cform-id="'+e+'">',t+=AEJSWP.custom_forms[e].flow_labels.cancel_button,t+="</a></div>",jQuery("#ae-cform-reset-password-instruction-"+e).html(t),jQuery("#ae-cform-reset-password-submit-"+e).hide(),jQuery("#ae-cform-reset-password-email-"+e).hide(),jQuery("#ae-cform-reset-password-login-link-"+e).hide(),jQuery("#ae-cform-reset-password-register-link-"+e).hide(),jQuery(".ae-cform-reset-password-cancel-link").click(function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));jQuery("#ae-cform-email-container-"+t).slideToggle(),jQuery("#ae-cform-reset-password-container-"+t).slideToggle(),jQuery("#ae-cform-title-"+t).slideDown(),jQuery("#ae-cform-signin-options-"+t).slideDown(),jQuery("#ae-cform-optins-container-"+t).slideDown(),AEJSWP.clearPasswordResetState()})},AEJSWP.displayEnterNewPassword=function(){AEJSWP.debugOutput("Showing password reset step 2");var e=AEJSWP.getLocalStorageItem("aejswp_cform_id");jQuery("#ae-cform-email-container-"+e).hide(),jQuery("#ae-cform-title-"+e).hide(),jQuery("#ae-cform-signin-options-"+e).hide(),jQuery("#ae-cform-reset-password-step1-"+e).hide(),jQuery("#ae-cform-reset-password-login-link-"+e).hide(),jQuery("#ae-cform-reset-password-register-link-"+e).hide(),jQuery("#ae-cform-reset-password-step2-"+e).show(),jQuery("#ae-cform-reset-password-container-"+e).show(),jQuery("#ae-cform-optins-container-"+e).hide()},AEJSWP.displayPasswordResetSuccess=function(){AEJSWP.debugOutput("Showing password reset success");var e=AEJSWP.getLocalStorageItem("aejswp_cform_id");jQuery("#ae-cform-reset-password-step2-"+e).hide(),jQuery("#ae-cform-reset-password-step3-"+e).show(),jQuery("#ae-cform-reset-password-login-link-"+e).show()},AEJSWP.clearPasswordResetState=function(){AEJSWP.debugOutput("Clearing password reset state"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_in_progress"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_email"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_member_service_id"),AEJSWP.removeSessionStorageItem("aejswp_password_reset_force_modal_open")},AEJSWP.updateCaslLabels=function(e){e?(jQuery(".ae-cform-optin-label-non-casl").hide(),jQuery(".ae-cform-optin-terms-non-casl").hide(),jQuery(".ae-cform-optin-label-casl").show(),jQuery(".ae-cform-optin-terms-casl").show(),jQuery(".ae-cform-optin-checkbox").attr("checked",!1),jQuery(".ae-cform-optin-checkbox").each(function(e){jQuery(this).trigger("change")})):(jQuery(".ae-cform-optin-label-non-casl").show(),jQuery(".ae-cform-optin-terms-non-casl").show(),jQuery(".ae-cform-optin-label-casl").hide(),jQuery(".ae-cform-optin-terms-casl").hide())},AEJSWP.displayRegistrationForm=function(e){jQuery("#ae-cform-email-login-container-"+e).slideToggle(),jQuery("#ae-cform-email-reg-container-"+e).slideToggle();var t=AEJSWP.custom_forms[e].modal_display_cta;AEJSWP.trackEvent("registrationModalShown",t)},AEJSWP.renderCaptcha=function(e){!AEJSWP.custom_forms.captchaLoadComplete||void 0===AEJSWP.aeJS&&void 0!==AEJSWP.aeJS.user||(AEJSWP.debugOutput("Looking for reCAPTCHAs to load."),void 0===AEJSWP.custom_forms[e].captcha_widget&&jQuery("#ae-cform-captcha-"+e).length&&(AEJSWP.debugOutput("Custom form has reCAPTCHA element. Now rendering."),AEJSWP.custom_forms[e].captcha_widget=grecaptcha.render("ae-cform-captcha-"+e,{sitekey:AEJSWP.custom_forms[e].recaptcha_key,callback:AEJSWP.captchaVerifyCallback})))},AEJSWP.hideCaptchaOnForm=function(e){AEJSWP.debugOutput("Hiding captcha field on form "+e),jQuery("#ae-cform-captcha-"+e).hide()},AEJSWP.captchaVerifyCallback=function(){AEJSWP.debugOutput("Google reCAPTCHA: Calling for token check across custom forms."),jQuery.each(AEJSWP.custom_forms,function(e,t){AEJSWP.debugOutput("Google reCAPTCHA: Check form "+e),void 0===AEJSWP.custom_forms[e].captcha_widget||AEJSWP.custom_forms[e].captchaVerified||(2==parseInt(AEJSWP.custom_forms[e].type_id)?(AEJSWP.debugOutput("Google reCAPTCHA completed, but deferring validation until form optins submitted"),AEJSWP.custom_forms[e].captchaVerified=!0):jQuery.ajax({url:AEJSWP.ajaxurl,method:"POST",type:"POST",dataType:"json",data:{action:AEJSWP.ajax_action_user_check_captcha,sitekey:AEJSWP.custom_forms[e].recaptcha_key,confirmcode:grecaptcha.getResponse(AEJSWP.custom_forms[e].captcha_widget),formid:e},success:function(t){AEJSWP.debugOutput("Google reCAPTCHA: Response "+t.success),1==t.success?(AEJSWP.debugOutput("Google reCAPTCHA: Custom form "+e+" validated"),AEJSWP.custom_forms[e].captchaVerified=!0):(AEJSWP.debugOutput("Google reCAPTCHA: failed (not validated)"),AEJSWP.custom_forms[e].captchaVerified=!1)},error:function(t,r,o){AEJSWP.debugOutput("Google reCAPTCHA: failed (AJAX Failed) "+r),AEJSWP.custom_forms[e].captchaVerified=!1}}))})},AEJSWP.triggerCustomFormModal=function(e){if(jQuery("#ae-cform-modal-container-"+e).length){jQuery("#ae-cform-modal-container-"+e).modal();var t=AEJSWP.getSessionStorageItem("aejswp_user_opened_cform_modal_display",!0)?AEJSWP.getSessionStorageItem("aejswp_user_opened_cform_modal_display",!0):[];t[e]=!0,AEJSWP.setSessionStorageItem("aejswp_user_opened_cform_modal_display",t,!0);var r=AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display")?AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display",!0):[];r[e]=!1,AEJSWP.setSessionStorageItem("aejswp_user_cancelled_cform_modal_display",r,!0);var o=AEJSWP.custom_forms[e].modal_display_cta;AEJSWP.trackEvent("loginModalShown",o)}};var onCaptchaloadCallback=function(){AEJSWP.debugOutput("Google reCAPTCHA script loaded correctly."),AEJSWP.custom_forms.captchaLoadComplete=!0};AEJSWP.getCustomCTAFormID=function(e,t){void 0===t&&(t=jQuery(".ae-cform-container").first().attr("data-ae-cform-id"));var r=t,o=jQuery(e).attr("class");if(jQuery(e).attr("data-form-id"))r=jQuery(e).attr("data-form-id");else if(o.length&&o.includes("ae-form-id-")){var a=o.split(/\s+/);if(a.length)for(var s=0;s<a.length;s++)a[s].includes("ae-form-id-")&&(r=a[s].replace("ae-form-id-",""))}return r},AEJSWP.addCustomFormListeners=function(){jQuery(".ae-custom-cta ").on("click",function(e){e.preventDefault();var t=AEJSWP.getCustomCTAFormID(jQuery(this));AEJSWP.triggerCustomFormModal(t)}),jQuery(".ae-cform-already-registered-link").click(function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));jQuery("#ae-cform-email-login-container-"+t).slideToggle(),jQuery("#ae-cform-email-reg-container-"+t).slideToggle()}),jQuery(".ae-cform-not-registered-link").click(function(e){e.preventDefault(),AEJSWP.displayRegistrationForm(parseInt(jQuery(this).data("ae-cform-id")))}),jQuery(".ae-cform-forgot-password-link").click(function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));jQuery("#ae-cform-email-container-"+t).slideToggle(),jQuery("#ae-cform-reset-password-container-"+t).slideToggle(),jQuery("#ae-cform-title-"+t).slideUp(),jQuery("#ae-cform-signin-options-"+t).slideUp(),jQuery("#reset-password-email-"+t).val(jQuery("#ae-cform-input-login-email-"+t).val()),jQuery("#ae-cform-optins-container-"+t).slideUp()}),jQuery(".ae-cform-reset-password-login-link").click(function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));jQuery("#ae-cform-email-container-"+t).slideToggle(),jQuery("#ae-cform-reset-password-container-"+t).slideToggle(),jQuery("#ae-cform-title-"+t).slideDown(),jQuery("#ae-cform-signin-options-"+t).slideDown(),jQuery("#ae-cform-optins-container-"+t).slideDown(),AEJSWP.clearPasswordResetState()}),jQuery(".ae-cform-reset-password-register-link").click(function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));jQuery("#ae-cform-email-login-container-"+t).hide(),jQuery("#ae-cform-email-reg-container-"+t).show(),jQuery("#ae-cform-email-container-"+t).slideToggle(),jQuery("#ae-cform-reset-password-container-"+t).slideToggle(),jQuery("#ae-cform-title-"+t).slideDown(),jQuery("#ae-cform-signin-options-"+t).slideDown(),jQuery("#ae-cform-optins-container-"+t).slideDown(),AEJSWP.clearPasswordResetState()}),jQuery(".ae-cform-reset-password-cancel-link").click(function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));jQuery("#ae-cform-email-container-"+t).slideToggle(),jQuery("#ae-cform-reset-password-container-"+t).slideToggle(),jQuery("#ae-cform-title-"+t).slideDown(),jQuery("#ae-cform-signin-options-"+t).slideDown(),jQuery("#ae-cform-optins-container-"+t).slideDown(),AEJSWP.clearPasswordResetState()}),jQuery(".ae-cform-verify-email-resend-link").click(function(e){e.preventDefault(),AEJSWP.getSessionStorageItem("aejswp_verify_email_in_progress")&&AEJSWP.sendVerifyEmail(AEJSWP.getSessionStorageItem("aejswp_verify_email_in_progress"))}),jQuery(".ae-cform-verify-email-cancel-link").click(function(e){e.preventDefault(),AEJSWP.aeJS.trigger.logout(),AEJSWP.removeSessionStorageItem("aejswp_verify_email_in_progress"),AEJSWP.removeSessionStorageItem("aejswp_verify_email_sent");var t=parseInt(jQuery(this).data("ae-cform-id"));jQuery("#ae-cform-verify-email-container-"+t).hide(),jQuery("#ae-cform-title-"+t).show(),jQuery("#ae-cform-signin-options-"+t).show(),jQuery("#ae-cform-email-container-"+t).show(),jQuery("#ae-cform-optins-container-"+t).show()}),jQuery(".ae-cform-reset-password-submit").click(function(e){AEJSWP.debugOutput("Password reset flow started"),e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id")),r=jQuery("#reset-password-email-"+t).val();AEJSWP.applyCustomFormSettings(t),AEJSWP.setSessionStorageItem("aejswp_password_reset_in_progress",!0),AEJSWP.sendVerifyEmail(r,t)}),jQuery(".ae-cform-update-password-submit").click(function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id")),r=jQuery("#reset-password-password-"+t).val();if(jQuery("#reset-password-password-"+t).parsley().validate(),jQuery("#reset-password-password-confirm-"+t).parsley().validate(),jQuery("#reset-password-password-"+t).parsley().isValid()&&jQuery("#reset-password-password-confirm-"+t).parsley().isValid()){var o=AEJSWP.getSessionStorageItem("aejswp_password_reset_email"),a=AEJSWP.getSessionStorageItem("aejswp_password_reset_member_service_id");AEJSWP.debugOutput("Updating user password for:"+o+", member_service_id "+a),AEJSWP.aeJS.trigger.reset_password(a,o,r)}}),jQuery(".ae-cform-optin-checkbox").length&&jQuery(".ae-cform-optin-checkbox").each(function(){jQuery(this).is(":checked")||(AEJSWP.debugOutput("Optin "+jQuery(this).data("ae-cform-id")+" is not checked"),AEJSWP.enableRegisterButton(jQuery(this).data("ae-optin-id"),!1))}),jQuery(".ae-cform-optin-checkbox").change(function(){jQuery(this).is(":checked")?(AEJSWP.debugOutput("Optin on custom form "+jQuery(this).data("ae-cform-id")+" has not been checked"),AEJSWP.enableRegisterButton(jQuery(this).data("ae-optin-id"),!0)):(AEJSWP.debugOutput("Optin on custom form "+jQuery(this).data("ae-cform-id")+" is checked"),AEJSWP.enableRegisterButton(jQuery(this).data("ae-optin-id"),!1)),event.preventDefault();var e=parseInt(jQuery(this).data("ae-optin-id")),t=AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0);t||(t=[]),t[e]=jQuery(this).is(":checked"),AEJSWP.setLocalStorageItem("aejswp_optin_choices",t,!0)}),jQuery("input[name*='s_birthdate']").on("input",function(){AEJSWP.updateDOB()}),jQuery("input[name='s_birthdate_day'],input[name='s_birthdate_month']").on("blur",function(){var e=AEJSWP.padString(jQuery(this).val(),2);e!=jQuery(this).val()&&""!=jQuery(this).val()&&jQuery(this).val(e)}),AEJSWP.customFormSelectedOptins=new Array(null),AEJSWP.customFormCountrySwitchedFrom="",jQuery(".ae-cform-input-country").change(function(){var e=jQuery(this).val(),t=parseInt(jQuery(this).data("ae-cform-id")),r="1"==AEJSWP.custom_forms[t].opt_ins_casl_enabled;if("1"==AEJSWP.custom_forms[t].gdpr_compliance_override_enabled){var o=AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0),a=jQuery(".ae-cform-optin-checkbox");if("US"==e||"UM"==e)AEJSWP.customFormSelectedOptins.length<2&&AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0).length>0&&(AEJSWP.customFormSelectedOptins=AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0)),AEJSWP.debugOutput("GDPR compliance override enabled & user selected United States or United States and Minor Outlying Islands, all optins are now pre-selected"),o=[null],jQuery(a).each(function(){jQuery(this).attr("checked",!0),o[jQuery(this).data("ae-optin-id")]=!0,AEJSWP.enableRegisterButton(jQuery(this).data("ae-optin-id"),!0)}),AEJSWP.setLocalStorageItem("aejswp_optin_choices",o,!0),AEJSWP.customFormCountrySwitchedFrom="US";else{if("US"==AEJSWP.customFormCountrySwitchedFrom&&(jQuery(a).each(function(){jQuery(this).attr("checked",!1),AEJSWP.enableRegisterButton(jQuery(this).data("ae-optin-id"),!1)}),AEJSWP.setLocalStorageItem("aejswp_optin_choices",[],!0),jQuery(a).each(function(e){jQuery(this).trigger("change")}),AEJSWP.debugOutput("GDPR compliance override enabled & user did not select United States or United States and Minor Outlying Islands"),AEJSWP.customFormSelectedOptins.length>1)){if(o=AEJSWP.customFormSelectedOptins,AEJSWP.debugOutput("User had made optin-in selection previously. Reverting to previous selection"),AEJSWP.setLocalStorageItem("aejswp_optin_choices",o,!0),o.length>1){o.forEach(function(e,t){0!=t&&1==e&&(jQuery('.ae-cform-optin-checkbox[data-ae-optin-id="'+t+'"]').attr("checked",!0),AEJSWP.enableRegisterButton(t,!0))})}AEJSWP.customFormSelectedOptins=new Array(null)}AEJSWP.customFormCountrySwitchedFrom="default"}AEJSWP.debugOutput("GDPR compliance override selection changes have been made")}if("CA"==e&&r){AEJSWP.debugOutput("CASL enabled & user selected Canada, updating opt-ins & terms for CASL compliance"),AEJSWP.updateCaslLabels(!0),AEJSWP.debugOutput("User completed CASL compliance flow, updating state");var s=AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0)?AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0):[];s[t]=!0,AEJSWP.removeSessionStorageItem("aejswp_user_casl_in_progress"),AEJSWP.setLocalStorageItem("aejswp_user_casl_completed",s,!0)}"CA"!=e&&r&&(AEJSWP.debugOutput("CASL enabled, but user selected another country, updating opt-in terms for non-CASL"),AEJSWP.updateCaslLabels(!1))}),jQuery(".ae-cform-modal-display-cta").click(function(e){e.preventDefault();var t=parseInt(jQuery(this).data("ae-cform-id"));AEJSWP.triggerCustomFormModal(t)}),void 0!==jQuery.modal&&jQuery(".ae-cform-modal-container").on(jQuery.modal.OPEN,function(e,t){jQuery(".close-modal").click(function(){AEJSWP.debugOutput("Modal closed by user");var e=AEJSWP.getLocalStorageItem("aejswp_cform_id");if(e){AEJSWP.debugOutput("storing the closure in session storage to avoid re-popping the modal up to the user on page refresh");var t=AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display")?AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display",!0):[];t[e]=!0,AEJSWP.setSessionStorageItem("aejswp_user_cancelled_cform_modal_display",t,!0)}})})},AEJSWP.updateDOB=function(){var e=jQuery("input[name='s_birthdate_day']").val();void 0!==e&&e.length>0&&(e=AEJSWP.padString(e,2));var t=jQuery("input[name='s_birthdate_month']").val();void 0!==t&&t.length>0&&(t=AEJSWP.padString(t,2));var r=jQuery("input[name='s_birthdate_year']").val();jQuery("input[name='birthdate']").val(r+"-"+t+"-"+e)},AEJSWP.setFormError=function(e,t){jQuery(".ae-cform-error-block",e).html(t).show()},AEJSWP.hideFormError=function(e){jQuery(".ae-cform-error-block",e).hide()},AEJSWP.enableRegisterButton=function(e,t){var r=jQuery('.ae-cform-optin-checkbox[data-ae-optin-id="'+e+'"]').data("ae-cform-id");if(1==parseInt(AEJSWP.custom_forms[r].modal_display))o=jQuery('.ae-cform-modal-container[data-ae-cform-id="'+r+'"]');else var o=jQuery('.ae-cform-container[data-ae-cform-id="'+r+'"]');jQuery("#ae-cform-optins-container-"+r).each(function(){jQuery(this).find(".ae-cform-optin-checkbox").each(function(){jQuery(this).is(":checked")&&jQuery(this).attr("id")!=e&&(t=!0)})}),"true"===AEJSWP.vv_auto_post_enabled&&(AEJSWP.debugOutput("VV autopost enabled"),t=!0),1==t?(o.find(".ae-cform-item-submit-button > input").removeAttr("disabled"),o.find(".ae-cform-item-submit-button > input").removeClass("ae-cform-item-submit-button-disabled"),o.find(".ae-cform-social-link").each(function(){if(void 0!==jQuery(this).data("ae-cform-social-button-service-id")&&void 0!==jQuery(this).attr("onclickholder")){var e=jQuery(this).attr("onclickholder");jQuery(this).removeAttr("onclickholder"),jQuery(this).attr("onclick",e),jQuery(this).removeClass("ae-cform-item-social-button-disabled")}})):(o.find(".ae-cform-item-submit-button > input").attr("disabled","disabled"),o.find(".ae-cform-item-submit-button > input").addClass("ae-cform-item-submit-button-disabled"),o.find(".ae-cform-social-link").each(function(){if(void 0!==jQuery(this).data("ae-cform-social-button-service-id")){var e=jQuery(this).attr("onclick");jQuery(this).removeAttr("onclick"),jQuery(this).attr("onclickholder",e),jQuery(this).addClass("ae-cform-item-social-button-disabled")}}))},AEJSWP.debugOutput=function(e,t){AEJSWP.debug&&(void 0!==t?console.log("AEJSWP: "+e,t):console.log("AEJSWP: "+e))},AEJSWP.debugOutput("AE Connect console logging enabled, disable debug in plugin settings to remove this output."),AEJSWP.debugOutput("Settings cached with plugin version: "+AEJSWP.plugin_version),AEJSWP.getQueryStringValue=function(e){return unescape(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+escape(e).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))},AEJSWP.removeURLParameter=function(e,t){var r=e.split("?");if(r.length>=2){for(var o=encodeURIComponent(t)+"=",a=r[1].split(/[&;]/g),s=a.length;s-- >0;)-1!==a[s].lastIndexOf(o,0)&&a.splice(s,1);return e=r[0]+(a.length>0?"?"+a.join("&"):"")}return e},AEJSWP.addURLParameter=function(e,t,r){return e.replace(new RegExp("([?&]"+t+"(?=[=&#]|$)[^#&]*|(?=#|$))"),"&"+t+"="+encodeURIComponent(r)).replace(/^([^?&]+)&/,"$1?")},AEJSWP.executeFunctionByName=function(e,t){for(var r=Array.prototype.slice.call(arguments,2),o=e.split("."),a=o.pop(),s=0;s<o.length;s++){if(void 0===t)return!1;t=t[o[s]]}return void 0!==t&&void 0!==t[a]&&t[a].apply(t,r)},AEJSWP.setSessionStorageItem=function(e,t,r){try{return void 0===r&&(r=!1),"undefined"!=typeof Storage&&(r?sessionStorage.setItem(e,JSON.stringify(t)):sessionStorage.setItem(e,t),!0)}catch(e){return!1}},AEJSWP.getSessionStorageItem=function(e,t){try{if(void 0===t&&(t=!1),"undefined"!=typeof Storage){var r=sessionStorage.getItem(e);return r="true"==r||r,r="false"!=r&&r,t&&(r=JSON.parse(r)),r}return!1}catch(e){return!1}},AEJSWP.removeSessionStorageItem=function(e){try{return"undefined"!=typeof Storage&&(sessionStorage.removeItem(e),!0)}catch(e){return!1}},AEJSWP.setLocalStorageItem=function(e,t,r){try{return void 0===r&&(r=!1),"undefined"!=typeof Storage&&(r?localStorage.setItem(e,JSON.stringify(t)):localStorage.setItem(e,t),!0)}catch(e){return!1}},AEJSWP.getLocalStorageItem=function(e,t){try{if(void 0===t&&(t=!1),"undefined"!=typeof Storage){var r=localStorage.getItem(e);return r="true"==r||r,r="false"!=r&&r,t&&(r=JSON.parse(r)),r}return!1}catch(e){return!1}},AEJSWP.removeLocalStorageItem=function(e){try{return"undefined"!=typeof Storage&&(localStorage.removeItem(e),!0)}catch(e){return!1}},AEJSWP.providerExistsInServices=function(e,t){for(var r in e){var o=e[r];if(void 0!==o.Service&&o.Service==t)return!0}return!1},AEJSWP.getLastLoginService=function(e){var t={},r="2000-01-01 00:00:00";for(var o in e){var a=e[o];void 0!==a.Service&&"undefined"!=a.LastLogin&&a.LastLogin>r&&(t=a,r=a.LastLogin)}return t},AEJSWP.padString=function(e,t){return(e=e.toString()).length<t?AEJSWP.padString("0"+e,t):e},AEJSWP.userHasVerifiedEmail=function(){return void 0!==AEJSWP.aeJS.user.data&&void 0!==AEJSWP.aeJS.user.data.VerifiedEmail&&""!=AEJSWP.aeJS.user.data.VerifiedEmail},AEJSWP.clearSessionStorage=function(){AEJSWP.debugOutput("Clearing all session storage"),AEJSWP.removeSessionStorageItem("aejswp_ae_login_fired"),AEJSWP.removeSessionStorageItem("aejswp_initial_optin_choices"),AEJSWP.removeSessionStorageItem("aewpjs_login_error_status_6_displayed"),AEJSWP.removeSessionStorageItem("aewpjs_sso_attempted"),AEJSWP.clearCustomFormState(!0)},AEJSWP.getCurrentState=function(){AEJSWP.debugOutput("CURRENT STATE >>"),AEJSWP.debugOutput("",AEJSWP),AEJSWP.debugOutput("aeJS",AEJSWP.aeJS),AEJSWP.debugOutput("user",AEJSWP.aeJS.user),AEJSWP.debugOutput("SessionStorage: aejswp_cform_id",AEJSWP.getLocalStorageItem("aejswp_cform_id")),AEJSWP.debugOutput("SessionStorage: aejswp_cform_prev_return_url",AEJSWP.getSessionStorageItem("aejswp_cform_prev_return_url")),AEJSWP.debugOutput("SessionStorage: aejswp_cform_prev_auth_window",AEJSWP.getSessionStorageItem("aejswp_cform_prev_auth_window")),AEJSWP.debugOutput("SessionStorage: aejswp_cform_prev_extra_fields",AEJSWP.getSessionStorageItem("aejswp_cform_prev_extra_fields"),!0),AEJSWP.debugOutput("SessionStorage: aejswp_ae_login_fired",AEJSWP.getSessionStorageItem("aejswp_ae_login_fired")),AEJSWP.debugOutput("SessionStorage: aejswp_verify_email_in_progress",AEJSWP.getSessionStorageItem("aejswp_verify_email_in_progress")),AEJSWP.debugOutput("SessionStorage: aejswp_verify_email_sent",AEJSWP.getSessionStorageItem("aejswp_verify_email_sent")),AEJSWP.debugOutput("SessionStorage: aejswp_password_reset_in_progress",AEJSWP.getSessionStorageItem("aejswp_password_reset_in_progress")),AEJSWP.debugOutput("SessionStorage: aejswp_password_reset_email",AEJSWP.getSessionStorageItem("aejswp_password_reset_email")),AEJSWP.debugOutput("SessionStorage: aejswp_password_reset_member_service_id",AEJSWP.getSessionStorageItem("aejswp_password_reset_member_service_id")),AEJSWP.debugOutput("SessionStorage: aejswp_password_reset_force_modal_open",AEJSWP.getSessionStorageItem("aejswp_password_reset_force_modal_open")),AEJSWP.debugOutput("SessionStorage: aejswp_user_casl_in_progress",AEJSWP.getSessionStorageItem("aejswp_user_casl_in_progress",!0)),AEJSWP.debugOutput("SessionStorage: aejswp_initial_optin_choices",AEJSWP.getSessionStorageItem("aejswp_initial_optin_choices",!0)),AEJSWP.debugOutput("SessionStorage: aejswp_user_cancelled_cform_modal_display",AEJSWP.getSessionStorageItem("aejswp_user_cancelled_cform_modal_display",!0)),AEJSWP.debugOutput("SessionStorage: aejswp_user_opened_cform_modal_display",AEJSWP.getSessionStorageItem("aejswp_user_opened_cform_modal_display",!0)),AEJSWP.debugOutput("SessionStorage: aewpjs_login_error_status_6_displayed",AEJSWP.getSessionStorageItem("aewpjs_login_error_status_6_displayed")),AEJSWP.debugOutput("SessionStorage: aewpjs_sso_attempted",AEJSWP.getSessionStorageItem("aewpjs_sso_attempted")),AEJSWP.debugOutput("LocalStorage: aejswp_user_casl_completed",AEJSWP.getLocalStorageItem("aejswp_user_casl_completed",!0)),AEJSWP.debugOutput("LocalStorage: aejswp_first_optins_post_completed",AEJSWP.getLocalStorageItem("aejswp_first_optins_post_completed",!0)),AEJSWP.debugOutput("LocalStorage: aeswp_cform_mailing_lists_completed",AEJSWP.getLocalStorageItem("aeswp_cform_mailing_lists_completed",!0)),AEJSWP.debugOutput("LocalStorage: aejswp_optin_choices",AEJSWP.getLocalStorageItem("aejswp_optin_choices",!0))},AEJSWP.resetAllState=function(){AEJSWP.debugOutput("Clearing all local storage"),AEJSWP.removeLocalStorageItem("aeswp_cform_mailing_lists_completed"),AEJSWP.removeLocalStorageItem("aejswp_optin_choices"),AEJSWP.removeLocalStorageItem("aejswp_user_casl_completed"),AEJSWP.removeLocalStorageItem("aejswp_first_optins_post_completed"),AEJSWP.logout()},AEJSWP.add_aejsready_handler=function(e){AEJSWP.debugOutput("Adding custom aejsready handler function : "+e),AEJSWP.aejsready_handlers.push(e)},AEJSWP.add_wait_for_event=function(e){AEJSWP.debugOutput("Adding event waiter: "+e),AEJSWP.event_waiters[e]=!1},AEJSWP.maybe_wait_for_event=function(e,t){AEJSWP.debugOutput("Maybe waiting for event : "+e),void 0===AEJSWP.event_waiters[e]||!1!==AEJSWP.event_waiters[e]?(AEJSWP.debugOutput("Wait not required, callback is ready for : "+e),t()):(AEJSWP.debugOutput("Waiting for callback : "+e),AEJSWP.event_waiters[e]=t)},AEJSWP.execute_wait_for_event=function(e){AEJSWP.debugOutput("Trying to executing event waiter : "+e),void 0!==AEJSWP.event_waiters[e]&&!1!==AEJSWP.event_waiters[e]?(AEJSWP.debugOutput("Event is ready to be executed: "+e),AEJSWP.event_waiters[e]()):(AEJSWP.debugOutput("Event not ready for execution so adding to waiting list: "+e),AEJSWP.event_waiters[e]=!0)},AEJSWP.add_data_filter=function(e,t){AEJSWP.debugOutput("Adding data filter: "+e),AEJSWP.data_filters[e]=t},AEJSWP.run_filter=function(e,t){return void 0!==AEJSWP.data_filters[e]?AEJSWP.data_filters[e](t):t},AEJSWP.logout=function(){AEJSWP.clearSessionStorage();var e=AEJSWP.user_logged_in?AEJSWP.ae_logout_url_bare+"&return_url="+AEJSWP.wp_logout_url:AEJSWP.ae_logout_url;AEJSWP.debugOutput("Logout. Redirecting to AE logout handler : "+e),window.location.href=e},AEJSWP.get_user_country=function(e){void 0!==AEJSWP.aeJS&&Object.keys(AEJSWP.aeJS.user).length>0&&void 0!==AEJSWP.aeJS.user.data&&void 0!==AEJSWP.aeJS.user.data.CountryCode&&null!==AEJSWP.aeJS.user.data.CountryCode&&AEJSWP.aeJS.user.data.CountryCode.length>0?AEJSWP.executeFunctionByName(e,window,AEJSWP.aeJS.user.data.CountryCode):jQuery.ajax({type:"POST",method:"POST",url:AEJSWP.ajaxurl,data:{action:AEJSWP.ajax_action_user_get_country},success:function(t){AEJSWP.executeFunctionByName(e,window,t)}})},AEJSWP.triggerFrameworkFlow=function(){AEJSWP.detect_safari_incognito()||!AEJSWP.detect_cookies_enabled()?(jQuery("body").append('<div id="ae-browser-config-error" style="display:none;">'+(AEJSWP.detect_safari_incognito()?AEJSWP.safari_incognito_error:AEJSWP.cookies_disabled_error)+"</div>"),jQuery("#ae-browser-config-error").modal()):AEJSWP.aeJS.trigger.flow()},AEJSWP.add_url_param_to_return_url=function(e,t){void 0!==AEJSWP.return_url&&""!=AEJSWP.return_url||(AEJSWP.return_url=window.location.href),""==AEJSWP.getQueryStringValue(e)&&(AEJSWP.return_url=AEJSWP.addURLParameter(AEJSWP.return_url,e,t),AEJSWP.aeJS.settings.return_url=AEJSWP.return_url,void 0!==AEJSWP.login_redirect_url&&""!==AEJSWP.login_redirect_url&&(AEJSWP.login_redirect_url=AEJSWP.addURLParameter(AEJSWP.login_redirect_url,e,t))),AEJSWP.param_on_return_url_key=e,AEJSWP.param_on_return_url_value=t},AEJSWP.add_url_param_to_return_url_parms=function(e,t){void 0!==AEJSWP.return_url&&""!=AEJSWP.return_url||(AEJSWP.return_url=window.location.href);var r=decodeURIComponent(AEJSWP.getQueryString("return_url",AEJSWP.aeJS.settings.return_url));r.trim().length>0&&(r=AEJSWP.addURLParameter(r,e,t),AEJSWP.login_redirect_url.trim().length>0?(AEJSWP.login_redirect_url=AEJSWP.addURLParameter(AEJSWP.login_redirect_url,e,t),AEJSWP.aeJS.settings.login_redirect_url=AEJSWP.login_redirect_url):(AEJSWP.login_redirect_url=decodeURIComponent(r),AEJSWP.aeJS.settings.login_redirect_url=AEJSWP.login_redirect_url),AEJSWP.return_url=AEJSWP.queryStringUrlReplacement(AEJSWP.return_url,"return_url",encodeURIComponent(r)),AEJSWP.aeJS.settings.return_url=AEJSWP.return_url)},AEJSWP.remove_url_param_to_return_url_parms=function(e){void 0!==AEJSWP.return_url&&""!=AEJSWP.return_url||(AEJSWP.return_url=window.location.href);var t=decodeURIComponent(AEJSWP.getQueryString("return_url",AEJSWP.aeJS.settings.return_url));t.trim().length>0&&(t=AEJSWP.remove_url_parameter(t,e),AEJSWP.login_redirect_url.trim().length>0?(AEJSWP.login_redirect_url=AEJSWP.remove_url_parameter(decodeURIComponent(AEJSWP.login_redirect_url),e),AEJSWP.aeJS.settings.login_redirect_url=decodeURIComponent(AEJSWP.login_redirect_url)):(AEJSWP.login_redirect_url=decodeURIComponent(t),AEJSWP.aeJS.settings.login_redirect_url=AEJSWP.login_redirect_url),AEJSWP.return_url=AEJSWP.queryStringUrlReplacement(AEJSWP.return_url,"return_url",encodeURIComponent(AEJSWP.remove_url_parameter(decodeURIComponent(t),e))),AEJSWP.aeJS.settings.return_url=AEJSWP.return_url)},AEJSWP.remove_url_parameter=function(e,t){var r=e.split("?");if(r.length>=2){for(var o=encodeURIComponent(t)+"=",a=r[1].split(/[&;]/g),s=a.length;s-- >0;)-1!==a[s].lastIndexOf(o,0)&&a.splice(s,1);return e=r[0]+(a.length>0?"?"+a.join("&"):"")}return e},AEJSWP.queryStringUrlReplacement=function(e,t,r){var o,a,s=new RegExp("[\\?&]"+t+"=([^&#]*)","i"),i=s.exec(e);if(null===i){a=e+(o=/\?/.test(e)?"&":"?")+t+"="+r}else o=i[0].charAt(0),a=e.replace(s,o+t+"="+r);return a},AEJSWP.getQueryString=function(e,t){var r=t||window.location.href,o=new RegExp("[?&]"+e+"=([^&#]*)","i").exec(r);return o?o[1]:null};
//# sourceMappingURL=ae_wp-min.js.map
